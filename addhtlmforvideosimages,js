<div style="max-width:900px;margin:auto">
  <textarea id="inputText" style="width:100%;height:200px;" placeholder="Pega aquí tu contenido"></textarea>
  <div style="margin-top:10px;">
    <button onclick="processAndCopy()">Procesar y Copiar</button>
    <button onclick="clearInput()">Limpiar</button>
  </div>
  <textarea id="outputText" readonly style="width:100%;height:250px;margin-top:15px;" placeholder="Resultado con URLs íntegras"></textarea>
  <div id="msg" style="opacity:0; transition:opacity 1.5s; margin-top:8px; font-weight:bold; color:green;">Procesado</div>
</div>

<script>
const MAX_WIDTH = 750;

// Nueva limpieza: NO corta caracteres finales de IDs de YouTube
function cleanUrlSafe(url) {
  // Solo eliminamos caracteres que DEFINITIVAMENTE no son parte de una URL (comillas de cierre, llaves)
  // Pero mantenemos puntos, guiones y letras.
  return url.replace(/["'<>]+$/g, '').trim();
}

function convertContent(content) {
  let lines = content.split(/\r?\n/);
  let output = [];

  for (let line of lines) {
    let rawLine = line.trim();

    // 1. Si la línea ya tiene HTML complejo de WordPress, NO TOCAR.
    if (/<[^>]{5,}>/.test(line) || /data-/.test(line) || /srcset=/.test(line)) {
      output.push(line);
      continue;
    }

    if (!rawLine) {
      output.push("");
      continue;
    }

    // 2. EXTRACCIÓN DIRECTA CON REGEX (Sin usar Split)
    // Buscamos la URL directamente en la línea
    let urlMatch = rawLine.match(/https?:\/\/[^\s"'<>]+/i);
    
    // Si no hay ninguna URL en la línea, la pasamos como texto
    if (!urlMatch) {
      output.push(line);
      continue;
    }

    let fullUrl = urlMatch[0]; 
    let cleanedUrl = cleanUrlSafe(fullUrl);

    // 3. Verificamos si la línea es EXCLUSIVAMENTE esa URL (o casi)
    // Esto evita procesar títulos de videos como embeds.
    if (rawLine.length > cleanedUrl.length + 5) {
      output.push(line);
      continue;
    }

    /* -------- PROCESAR YOUTUBE -------- */
    let yt = cleanedUrl.match(/(?:watch\?v=|youtu\.be\/|shorts\/|embed\/)([a-zA-Z0-9_-]+)/);
    if (yt && yt[1]) {
      output.push(`
<div style="max-width:${MAX_WIDTH}px;margin:20px auto;">
<iframe width="100%" height="422" src="https://www.youtube.com/embed/${yt[1]}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>`);
      continue;
    }

    /* -------- PROCESAR IMÁGENES -------- */
    if (cleanedUrl.match(/\.(jpg|jpeg|png|gif|webp|bmp)/i)) {
      output.push(`
<div style="text-align:center;margin:15px 0;">
<img src="${cleanedUrl}" style="max-width:${MAX_WIDTH}px;width:100%;height:auto;">
</div>`);
      continue;
    }

    /* -------- OTROS ENLACES SUELTOS -------- */
    output.push(`<p style="text-align:center;"><a href="${cleanedUrl}" target="_blank" rel="follow">${cleanedUrl}</a></p>`);
  }

  return output.join("\n");
}

async function processAndCopy() {
  let input = document.getElementById("inputText").value;
  if(!input.trim()) return;
  
  let result = convertContent(input);
  document.getElementById("outputText").value = result;
  
  try {
    await navigator.clipboard.writeText(result);
    showMsg("¡URL preservada y copiada!");
  } catch (err) {
    showMsg("Procesado (copia manual)");
  }
}

function showMsg(text) {
  const msg = document.getElementById("msg");
  msg.innerText = text;
  msg.style.opacity = 1;
  setTimeout(() => { msg.style.opacity = 0; }, 2500);
}

function clearInput() {
  document.getElementById("inputText").value = "";
  document.getElementById("outputText").value = "";
}
</script>
<div style="text-align:center;margin:30px 0;">
<a href="https://antibestia.com/2026/02/15/al-revisar-tus-notas-y-el-contenido-del-video-queda-claro-tu-no-defiendes-la-biblia-tu-la-diseccionas/" target="_blank">
<img src="https://antibestia.wordpress.com/wp-content/uploads/2026/02/en-el-equipo-de-la-logica-la-liga-de-la-logica-humana-y-digital.jpg"
style="max-width:750px;width:100%;height:auto;">
</a>
</div>
